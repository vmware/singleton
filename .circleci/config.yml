version: '2.1'
orbs:
  go: circleci/go@1.7.0
jobs:
  checkheader:
    executor:
      name: go/default
      tag: '1.16'
    steps:
      - checkout
      # - go/load-cache
      # - go/mod-download
      # - go/save-cache
      - run:
          name: check header
          env: TEST=check_header
          command: |
            if [ x${TEST} == xcheck_header ]; then
            git clone --branch=devops https://github.com/vmware/singleton.git devops
            cp $TRAVIS_BUILD_DIR/devops/check_headers.py .
            chmod +x check_headers.py
            python3 ./check_headers.py -f "$(git diff --name-only --diff-filter=d $TRAVIS_COMMIT_RANGE)"
            fi


  build:
    executor:
        name: go/default
        tag: '1.16'
    steps:
    - checkout
    - run:
        name: build
        env: TEST=build
        command: |
          if [ x${TEST} = xbuild ]; then
          make build
          fi


workflows:
  main:
    jobs:
      - checkheader:
          filters:
            branches:
              only:
                - g11n-go-service
      - build:
          filters:
            branches:
              only:
                - g11n-go-service

          
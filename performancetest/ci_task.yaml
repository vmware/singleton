performance-test:
    name: Performance Test
    runs-on: ubuntu-latest
    needs: pre-process
    if: needs.pre-process.outputs.were-only-docs-updated != 'yes'
    steps:
        -   name: Checkout code
            uses: actions/checkout@v2
        -   name: Set up JDK 8
            uses: actions/setup-java@v2
            with:
                distribution: 'adopt'
                java-version: '8'
        -   name: Set up Python
            uses: actions/setup-python@v4
            with:
                python-version: '3.x'
                architecture: 'x64'
        -   name: Performance Test
            run: |
                git clone --branch=simple_performance https://github.com/mabeijing/singleton.git simple_performance
                cd $GITHUB_WORKSPACE/g11n-ws && ./gradlew build -x test
                cp $GITHUB_WORKSPACE/simple_performance/performancetest/Dockerfile $GITHUB_WORKSPACE/publish/
                cp -r $GITHUB_WORKSPACE/simple_performance/performancetest/resource/l10n $GITHUB_WORKSPACE/publish/
                cd $GITHUB_WORKSPACE/publish && ls
                mv singleton-[0~9]*.jar i18n-service.jar && ls
                docker build -t singleton .
                docker run -d -p 8090:8090 --name singleton singleton
                docker ps
                cd $GITHUB_WORKSPACE/simple_performance/performancetest
                pip install -r requirements.txt
                cat /proc/cpuinfo | grep "cpu cores"
                free -m
                python -V
                python performance.py